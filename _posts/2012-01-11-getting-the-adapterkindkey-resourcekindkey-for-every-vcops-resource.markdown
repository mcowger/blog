---
layout: post
status: publish
published: true
title: Getting the AdapterKindKey & ResourceKindKey for every vCops Resource
author:
  display_name: mcowger
  login: mcowger
  email: matt@cowger.us
  url: ''
author_login: mcowger
author_email: matt@cowger.us
wordpress_id: 225
wordpress_url: http://www.exaforge.com/?p=225
date: '2012-01-11 13:20:04 -0500'
date_gmt: '2012-01-11 21:20:04 -0500'
categories:
- Uncategorized
tags:
- vCenter Operations
- vCops
comments: []
---
<p>Just a quick post today as I'm working on a secret project. &nbsp;I had a need to identify the AdapterKindKey &amp; ResourceKindKey for every resource in vCops. &nbsp;Thats not as easy as it sounds, because the OpenHTTPAdapterAPI doesn't allow you to just list resource - you have to know what resource you want, along with its KindKeys before you can get its metric data. &nbsp;As a result, you have to get the information from the SQL database directly.</p>
<p>Because these are in a database schema thats pretty solidly <a href="http://en.wikipedia.org/wiki/Database_normalization">normalized</a>, so we have to do a couple of <a href="http://en.wikipedia.org/wiki/Join_(SQL)#Inner_join">SQL joins</a> to get all the information back in one query. &nbsp;In my case, I wanted the resource Name, ResourceKindKey and AdapterKindKey all together. &nbsp;</p>
<p>The query ended up looking like this:</p>
<p>&nbsp;</p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;">SELECT Name,RESKND_KEY,ADAPTER_KEY FROM AliveResource,ResourceKind,AdapterKind WHERE (AliveResource.RESKND_ID = ResourceKind.RESKND_ID AND AdapterKind.ADAPTER_KIND_ID = ResourceKind.ADAPTER_KIND_ID);</span></p>
<p>&nbsp;</p>
<p>So how did I get to there. &nbsp;First, I simply took a look at the AliveResource table to see what I got:</p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;">SELECT * FROM AliveResource</span></p>
<p style="padding-left:30px;"><span style="font-size:small;">&nbsp;</span></p>
<p style="padding-left:30px;"><span style="font-size:small;"><span style="font-family:'courier new', courier;">RESOURCE_ID<span style="white-space:pre;"> </span>RESKND_ID<span style="white-space:pre;"> </span>NAME<span style="white-space:pre;"> </span>INFORMATION<span style="white-space:pre;"> </span>CRED_ID<span style="white-space:pre;"> </span>ATTRPKG_ID<span style="white-space:pre;"> </span>COLLECTOR_ID<span style="white-space:pre;"> </span>MONITORING_INTERVAL<span style="white-space:pre;"> </span>LAST_MAINTAIN_TIME<span style="white-space:pre;"> </span>MAINTAIN_UNTIL<span style="white-space:pre;"> </span>maintenanceScheduleId<span style="white-space:pre;"> </span>TYPE<span style="white-space:pre;"> </span>Latitude<span style="white-space:pre;"> </span>Longitude<span style="white-space:pre;"> </span>CURRENT_HEALTH<span style="white-space:pre;"> </span>BUSSVC_ID<span style="white-space:pre;"> </span>TIER_ID<span style="white-space:pre;"> </span>SMPackageId<span style="white-space:pre;"> </span>CreationTime<span style="white-space:pre;"> </span>SUBTYPE<span style="white-space:pre;"> </span>EarlyWarningAlertEnabled<span style="white-space:pre;"> </span>DT_ENABLED<span style="white-space:pre;"> </span>FLAG</span></span></p>
<p style="padding-left:30px;"><span style="font-size:small;"><span style="font-family:'courier new', courier;">1<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>vCenter Operations Adapter (vCenter Operations Server)<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>2<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>5<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>7<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>0<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>1324564710237<span style="white-space:pre;"> </span>2<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>null</span></span></p>
<p style="padding-left:30px;"><span style="font-size:small;"><span style="font-family:'courier new', courier;">2<span style="white-space:pre;"> </span>3<span style="white-space:pre;"> </span>vCenter Operations Collector (vCenter Operations Server)<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>6<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>5<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>0<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>1324564710294<span style="white-space:pre;"> </span>2<span style="white-space:pre;"> </span>0<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>null</span></span></p>
<p style="padding-left:30px;"><span style="font-size:small;"><span style="font-family:'courier new', courier;">&nbsp;</span><span style="font-family:'courier new', courier;">3</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">2</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">vCenter Operations Analytics</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">null</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">null</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">4</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">null</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">5</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">null</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">null</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">null</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">null</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">null</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">null</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">0</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">null</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">null</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">null</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">1324564710343</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">2</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">0</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">1</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">null</span></span></p>
<p><span style="font-size:small;">Wow, thats a lot, but I see that I have alot of what I want, including a Name column and a RESKND_ID column, which would give me the ResourceKindKey (a string) from another table. &nbsp;So lets limit the query a bit more:</span></p>
<p style="padding-left:30px;"><span style="font-size:small;">&nbsp;</span><span style="font-family:'courier new', courier;font-size:medium;">SELECT Name,RESKND_ID FROM AliveResource;</span></p>
<p style="padding-left:30px;"><span style="font-size:small;"><span style="font-family:'courier new', courier;">Name<span style="white-space:pre;"> </span>RESKND_ID</span></span></p>
<p style="padding-left:30px;"><span style="font-size:small;"><span style="font-family:'courier new', courier;">vCenter Operations Adapter (vCenter Operations Server)<span style="white-space:pre;"> </span>1</span></span></p>
<p style="padding-left:30px;"><span style="font-size:small;"><span style="font-family:'courier new', courier;">vCenter Operations Analytics<span style="white-space:pre;"> </span>2</span></span></p>
<p style="padding-left:30px;"><span style="font-size:small;"><span style="font-family:'courier new', courier;">vCenter Operations Collector (vCenter Operations Server)<span style="white-space:pre;"> </span>3</span></span></p>
<p style="padding-left:30px;"><span style="font-size:small;"><span style="font-family:'courier new', courier;">&nbsp;</span><span style="font-family:'courier new', courier;">vCenter Operations Message Queue</span><span style="white-space:pre;"> </span><span style="font-family:'courier new', courier;">4</span></span></p>
<p>&nbsp;</p>
<p><span style="font-size:small;"><br />
</span></p>
<p><span style="font-size:small;">OK, thats a little better and cleaner. &nbsp;But now what I want to do is use the RESKND_ID (which is just a number) to get the ResourceKindKey for that ID from the ResourceKind table. &nbsp;This is called a 'join', more specifically its an INNER JOIN. &nbsp;For the math nerds out there like me, its a Cartesian product of the two tables. &nbsp;So what I need to do is specify to the SQL engine which parts of the table are the same thing. &nbsp;Specifically, that the AliveResource.RESKND_ID values and the ResourceKind.RESKND_ID are the same thing, and would should combine based on that. &nbsp;The query looks like this:</span></p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">SELECT * FROM AliveResource,ResourceKind WHERE AliveResource.RESKND_ID = ResourceKind.RESKND_ID</span></span></p>
<p style="padding-left:30px;">&nbsp;</p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">Name<span style="white-space:pre;"> </span>RESOURCE_ID<span style="white-space:pre;"> </span>RESKND_ID<span style="white-space:pre;"> </span>NAME<span style="white-space:pre;"> </span>INFORMATION<span style="white-space:pre;"> </span>CRED_ID<span style="white-space:pre;"> </span>ATTRPKG_ID<span style="white-space:pre;"> </span>COLLECTOR_ID<span style="white-space:pre;"> </span>MONITORING_INTERVAL<span style="white-space:pre;"> </span>LAST_MAINTAIN_TIME<span style="white-space:pre;"> </span>MAINTAIN_UNTIL<span style="white-space:pre;"> </span>maintenanceScheduleId<span style="white-space:pre;"> </span>TYPE<span style="white-space:pre;"> </span>Latitude<span style="white-space:pre;"> </span>Longitude<span style="white-space:pre;"> </span>CURRENT_HEALTH<span style="white-space:pre;"> </span>BUSSVC_ID<span style="white-space:pre;"> </span>TIER_ID<span style="white-space:pre;"> </span>SMPackageId<span style="white-space:pre;"> </span>CreationTime<span style="white-space:pre;"> </span>SUBTYPE<span style="white-space:pre;"> </span>EarlyWarningAlertEnabled<span style="white-space:pre;"> </span>DT_ENABLED<span style="white-space:pre;"> </span>FLAG<span style="white-space:pre;"> </span>RESKND_ID<span style="white-space:pre;"> </span>RESKND_KEY<span style="white-space:pre;"> </span>ADAPTER_KIND_ID<span style="white-space:pre;"> </span>NAME_ID<span style="white-space:pre;"> </span>TYPE<span style="white-space:pre;"> </span>SUBTYPE<span style="white-space:pre;"> </span>ICON<span style="white-space:pre;"> </span>SHOW_TAG<span style="white-space:pre;"> </span>ATTRPKG_ID<span style="white-space:pre;"> </span>SMPackageId<span style="white-space:pre;"> </span>DYNAMIC<span style="white-space:pre;"> </span>DT_ENABLED<span style="white-space:pre;"> </span>EarlyWarningAlertEnabled</span></span></p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">vCenter Operations Adapter (vCenter Operations Server)<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>vCenter Operations Adapter (vCenter Operations Server)<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>2<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>5<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>7<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>0<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>1324564710237<span style="white-space:pre;"> </span>2<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>vCenter Operations Adapter Instance<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>10<span style="white-space:pre;"> </span>7<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>1.png<span style="white-space:pre;"> </span>0<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null</span></span></p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">vCenter Operations Collector (vCenter Operations Server)<span style="white-space:pre;"> </span>2<span style="white-space:pre;"> </span>3<span style="white-space:pre;"> </span>vCenter Operations Collector (vCenter Operations Server)<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>6<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>5<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>0<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>1324564710294<span style="white-space:pre;"> </span>2<span style="white-space:pre;"> </span>0<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>3<span style="white-space:pre;"> </span>Collector<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>3<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>named_Collector.png<span style="white-space:pre;"> </span>0<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null</span></span></p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">vCenter Operations Analytics<span style="white-space:pre;"> </span>3<span style="white-space:pre;"> </span>2<span style="white-space:pre;"> </span>vCenter Operations Analytics<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>4<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>5<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>0<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>1324564710343<span style="white-space:pre;"> </span>2<span style="white-space:pre;"> </span>0<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>2<span style="white-space:pre;"> </span>Analytics<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>2<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>named_Analytics.png<span style="white-space:pre;"> </span>0<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null</span></span></p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">vCenter Operations Web Server<span style="white-space:pre;"> </span>4<span style="white-space:pre;"> </span>5<span style="white-space:pre;"> </span>vCenter Operations Web Server<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>10<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>5<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>0<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>1324564710371<span style="white-space:pre;"> </span>2<span style="white-space:pre;"> </span>0<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>5<span style="white-space:pre;"> </span>Web<span style="white-space:pre;"> </span>1<span style="white-space:pre;"> </span>5<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>named_Web.png<span style="white-space:pre;"> </span>0<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null<span style="white-space:pre;"> </span>null</span></span></p>
<p><span style="font-size:small;">Whoa, thats a lot of data, so lets narrow it down by just selecting the columns I want:</span></p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">SELECT Name,RESKND_KEY FROM AliveResource,ResourceKind WHERE AliveResource.RESKND_ID = ResourceKind.RESKND_ID</span></span></p>
<p style="padding-left:30px;">&nbsp;</p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">Name<span style="white-space:pre;"> </span>RESKND_KEY</span></span></p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">vCenter Operations Analytics<span style="white-space:pre;"> </span>Analytics</span></span></p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">DISK<span style="white-space:pre;"> </span>ARRAY_SUMMARY</span></span></p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">LUN_EFDCACHEADMIN<span style="white-space:pre;"> </span>ARRAY_SUMMARY</span></span></p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">LUN_FLARE<span style="white-space:pre;"> </span>ARRAY_SUMMARY</span></span></p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">LUN_MLUADMIN<span style="white-space:pre;"> </span>ARRAY_SUMMARY</span></span></p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">SP<span style="white-space:pre;"> </span>ARRAY_SUMMARY</span></span></p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">VMware vCenter Operations<span style="white-space:pre;"> </span>BusinessService</span></span></p>
<p><span style="font-size:small;">Aha, thats a little better. &nbsp;But I also wanted the AdapterKindKey too, and thats in a third table. &nbsp;Well, another JOIN is certainly allowed (albeit computationally expensive, as we are talking about a 3D Cartesian product here). &nbsp;However, I have fast computers and this is a pretty small database, so lets give it a show, this timeing joining ResourceKind.ADAPTER_KIND_ID and AdapterKind.ADAPTER_KIND_ID along with my previous join. &nbsp;Also, we'll only select the columns we want to keep it clean:</span></p>
<p style="padding-left:30px;"><span style="font-family:'courier new', courier;"><span style="font-size:small;">SELECT Name,RESKND_KEY,ADAPTER_KEY FROM AliveResource,ResourceKind,AdapterKind WHERE (AliveResource.RESKND_ID = ResourceKind.RESKND_ID AND AdapterKind.ADAPTER_KIND_ID = ResourceKind.ADAPTER_KIND_ID);</span></span></p>
<p style="padding-left:30px;"><span style="font-size:small;">&nbsp;</span></p>
<p><span style="font-size:small;"><span style="font-family:'courier new', courier;">Name<span style="white-space:pre;"> </span>RESKND_KEY<span style="white-space:pre;"> </span>ADAPTER_KEY</span></span></p>
<p><span style="font-size:small;"><span style="font-family:'courier new', courier;">vCenter Operations Adapter (vCenter Operations Server)<span style="white-space:pre;"> </span>vCenter Operations Adapter Instance<span style="white-space:pre;"> </span>vCenter Operations Adapter</span></span></p>
<p><span style="font-size:small;"><span style="font-family:'courier new', courier;">vCenter Operations Analytics<span style="white-space:pre;"> </span>Analytics<span style="white-space:pre;"> </span>vCenter Operations Adapter</span></span></p>
<p><span style="font-size:small;"><span style="font-family:'courier new', courier;">vCenter Operations Collector (vCenter Operations Server)<span style="white-space:pre;"> </span>Collector<span style="white-space:pre;"> </span>vCenter Operations Adapter</span></span></p>
<p><span style="font-size:small;"><span style="font-family:'courier new', courier;">vCenter Operations Message Queue<span style="white-space:pre;"> </span>MQ<span style="white-space:pre;"> </span>vCenter Operations Adapter</span></span></p>
<p><span style="font-size:small;"><span style="font-family:'courier new', courier;">vCenter Operations Web Server<span style="white-space:pre;"> </span>Web<span style="white-space:pre;"> </span>vCenter Operations Adapter</span></span></p>
<p><span style="font-size:small;"><span style="font-family:'courier new', courier;">Http Post (vCenter Operations Server)<span style="white-space:pre;"> </span>Http Post Adapter Instance<span style="white-space:pre;"> </span>Http Post</span></span></p>
<p style="padding-left:30px;"><span style="font-size:small;"><span style="font-family:'courier new', courier;">VMware vCenter Operations<span style="white-space:pre;"> </span>BusinessService<span style="white-space:pre;"> </span>Container</span></span></p>
<p><span style="font-size:small;">Et voila! &nbsp;We have what we wanted! &nbsp;Neato!</span></p>
<p>&nbsp;</p>
<p style="padding-left:30px;">&nbsp;</p>
<p style="padding-left:30px;">&nbsp;</p>
